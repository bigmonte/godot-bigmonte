From e69fb86e0082f60a081d43dc028b868a0b009e90 Mon Sep 17 00:00:00 2001
From: Terran Olson <terran@halfcadence.net>
Date: Sun, 8 Mar 2020 13:55:18 -0700
Subject: [PATCH] fix #34431 animation editor ignores step size

---
 editor/plugins/animation_player_editor_plugin.cpp | 10 +++++++++-
 editor/plugins/animation_player_editor_plugin.h   |  1 +
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/editor/plugins/animation_player_editor_plugin.cpp b/editor/plugins/animation_player_editor_plugin.cpp
index af12335a27d..4e91fb9b4a1 100644
--- a/editor/plugins/animation_player_editor_plugin.cpp
+++ b/editor/plugins/animation_player_editor_plugin.cpp
@@ -296,6 +296,7 @@ void AnimationPlayerEditor::_animation_selected(int p_which) {
 			}
 		}
 		frame->set_max(anim->get_length());
+		_update_frame_step(anim->get_step());
 
 	} else {
 		track_editor->set_animation(Ref<Animation>());
@@ -896,6 +897,12 @@ void AnimationPlayerEditor::_update_player() {
 	_update_animation();
 }
 
+void AnimationPlayerEditor::_update_frame_step(float p_len) {
+	if (!p_len)
+		p_len = 0.00001;
+	frame->set_step(p_len);
+}
+
 void AnimationPlayerEditor::edit(AnimationPlayer *p_player) {
 
 	if (player && pin->is_pressed())
@@ -1595,7 +1602,7 @@ AnimationPlayerEditor::AnimationPlayerEditor(EditorNode *p_editor, AnimationPlay
 	hb->add_child(frame);
 	frame->set_custom_minimum_size(Size2(60, 0));
 	frame->set_stretch_ratio(2);
-	frame->set_step(0.0001);
+	_update_frame_step();
 	frame->set_tooltip(TTR("Animation position (in seconds)."));
 
 	hb->add_child(memnew(VSeparator));
@@ -1746,6 +1753,7 @@ AnimationPlayerEditor::AnimationPlayerEditor(EditorNode *p_editor, AnimationPlay
 	track_editor->set_v_size_flags(SIZE_EXPAND_FILL);
 	track_editor->connect("timeline_changed", callable_mp(this, &AnimationPlayerEditor::_animation_key_editor_seek));
 	track_editor->connect("animation_len_changed", callable_mp(this, &AnimationPlayerEditor::_animation_key_editor_anim_len_changed));
+	track_editor->connect("animation_step_changed", callable_mp(this, &AnimationPlayerEditor::_update_frame_step));
 
 	_update_player();
 
diff --git a/editor/plugins/animation_player_editor_plugin.h b/editor/plugins/animation_player_editor_plugin.h
index 1abefad6358..dcdc5fb7da6 100644
--- a/editor/plugins/animation_player_editor_plugin.h
+++ b/editor/plugins/animation_player_editor_plugin.h
@@ -192,6 +192,7 @@ class AnimationPlayerEditor : public VBoxContainer {
 
 	void _list_changed();
 	void _update_animation();
+	void _update_frame_step(float p_len = 0);
 	void _update_player();
 	void _blend_edited();
 

