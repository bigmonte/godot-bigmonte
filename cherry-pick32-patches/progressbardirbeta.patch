From 6271adb109cb4b7fedf3585744ef8ebca9bd16dc Mon Sep 17 00:00:00 2001
From: Kars <karssloeserwij@gmail.com>
Date: Thu, 27 Feb 2020 10:06:35 +0100
Subject: [PATCH] Add fill direction to progress bar

Fixed tab formating

More format fixing
---
 scene/gui/progress_bar.cpp | 52 +++++++++++++++++++++++++++++++++-----
 scene/gui/progress_bar.h   | 17 ++++++++++++-
 2 files changed, 61 insertions(+), 8 deletions(-)

diff --git a/scene/gui/progress_bar.cpp b/scene/gui/progress_bar.cpp
index e11295d7e74..1dab96cbd18 100644
--- a/scene/gui/progress_bar.cpp
+++ b/scene/gui/progress_bar.cpp
@@ -56,14 +56,29 @@ void ProgressBar::_notification(int p_what) {
 		Ref<StyleBox> fg = get_stylebox("fg");
 		Ref<Font> font = get_font("font");
 		Color font_color = get_color("font_color");
-
 		draw_style_box(bg, Rect2(Point2(), get_size()));
 		float r = get_as_ratio();
-		int mp = fg->get_minimum_size().width;
-		int p = r * (get_size().width - mp);
-		if (p > 0) {
 
-			draw_style_box(fg, Rect2(Point2(), Size2(p + fg->get_minimum_size().width, get_size().height)));
+		if (fill == FILL_RIGHT || fill == FILL_LEFT) {
+			int mp = fg->get_minimum_size().width;
+			int p = r * (get_size().width - mp);
+			if (p > 0) {
+				if (fill == FILL_RIGHT) {
+					draw_style_box(fg, Rect2(Point2(), Size2(p + fg->get_minimum_size().width, get_size().height)));
+				} else {
+					draw_style_box(fg, Rect2(Point2(get_size().width - (p + fg->get_minimum_size().width), 0), Size2(p + fg->get_minimum_size().width, get_size().height)));
+				}
+			}
+		} else {
+			int mp = fg->get_minimum_size().height;
+			int p = r * (get_size().height - mp);
+			if (p > 0) {
+				if (fill == FILL_DOWN) {
+					draw_style_box(fg, Rect2(Point2(), Size2(get_size().width, p + fg->get_minimum_size().height)));
+				} else {
+					draw_style_box(fg, Rect2(Point2(0, get_size().height - (p + fg->get_minimum_size().height)), Size2(get_size().width, p + fg->get_minimum_size().height)));
+				}
+			}
 		}
 
 		if (percent_visible) {
@@ -84,17 +99,40 @@ bool ProgressBar::is_percent_visible() const {
 	return percent_visible;
 }
 
+void ProgressBar::set_fill_mode(FillMode p_fill) {
+
+	fill = p_fill;
+	update();
+}
+
+ProgressBar::FillMode ProgressBar::get_fill_mode() const {
+
+	return fill;
+}
+
 void ProgressBar::_bind_methods() {
 
 	ClassDB::bind_method(D_METHOD("set_percent_visible", "visible"), &ProgressBar::set_percent_visible);
 	ClassDB::bind_method(D_METHOD("is_percent_visible"), &ProgressBar::is_percent_visible);
+
+	ClassDB::bind_method(D_METHOD("get_fill_mode"), &ProgressBar::get_fill_mode);
+	ClassDB::bind_method(D_METHOD("set_fill_mode", "fill_direction"), &ProgressBar::set_fill_mode);
+
 	ADD_GROUP("Percent", "percent_");
 	ADD_PROPERTY(PropertyInfo(Variant::BOOL, "percent_visible"), "set_percent_visible", "is_percent_visible");
+
+	BIND_ENUM_CONSTANT(FILL_UP);
+	BIND_ENUM_CONSTANT(FILL_DOWN);
+	BIND_ENUM_CONSTANT(FILL_LEFT);
+	BIND_ENUM_CONSTANT(FILL_RIGHT);
+
+	ADD_GROUP("Fill Direction", "fill_");
+	ADD_PROPERTY(PropertyInfo(Variant::INT, "fill_direction", PROPERTY_HINT_ENUM, "Up,Down,Left,Right"), "set_fill_mode", "get_fill_mode");
 }
 
 ProgressBar::ProgressBar() {
-
 	set_v_size_flags(0);
 	set_step(0.01);
 	percent_visible = true;
-}
+	fill = FILL_RIGHT;
+}
\ No newline at end of file
diff --git a/scene/gui/progress_bar.h b/scene/gui/progress_bar.h
index 371d0370f6f..846f70ab3ab 100644
--- a/scene/gui/progress_bar.h
+++ b/scene/gui/progress_bar.h
@@ -36,7 +36,6 @@
 class ProgressBar : public Range {
 
 	GDCLASS(ProgressBar, Range);
-
 	bool percent_visible;
 
 protected:
@@ -44,6 +43,20 @@ class ProgressBar : public Range {
 	static void _bind_methods();
 
 public:
+	enum FillMode {
+		FILL_UP,
+		FILL_DOWN,
+		FILL_LEFT,
+		FILL_RIGHT
+	};
+
+private:
+	FillMode fill;
+
+public:
+	void set_fill_mode(FillMode p_fill);
+	FillMode get_fill_mode() const;
+
 	void set_percent_visible(bool p_visible);
 	bool is_percent_visible() const;
 
@@ -51,4 +64,6 @@ class ProgressBar : public Range {
 	ProgressBar();
 };
 
+VARIANT_ENUM_CAST(ProgressBar::FillMode);
+
 #endif // PROGRESS_BAR_H

